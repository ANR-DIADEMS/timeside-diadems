data:
  image: debian:jessie
  volumes:
     - ./data/media/:/opt/data
     - ./data/static/:/opt/static
     - ./data/backup/:/opt/backup
  command: "true"

db:
  image: mysql
  volumes_from:
    - data
  environment:
    - MYSQL_ROOT_PASSWORD=ItCydyatzix8
    - MYSQL_DATABASE=telemeta
    - MYSQL_USER=telemeta
    - MYSQL_PASSWORD=iuvIlkyisFit2

broker:
  image: redis

app:
  build: .
  volumes:
    - ./app/:/opt/app
    - ./timeside/:/opt/src/app/timeside
  volumes_from:
    - data
  command: /bin/sh deploy/start_app.sh
  ports:
    - "9000:9000"
  expose:
    - "8000" #default runserver wsgi port
  links:
    - broker
    - db

worker:
  build: .
  volumes_from:
    - app
  command: /bin/sh deploy/celery_app.sh
  links:
    - broker
    - db

nginx:
  image: nginx
  ports:
    - "8000:80"
  volumes:
    - ./deploy/nginx-app.conf:/etc/nginx/conf.d/default.conf
    - ./log/:/var/log/nginx
  volumes_from:
    - data
  links:
    - app
